<!DOCTYPE html>
<html>
<head>
    <title>Packets Information</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
    <style>
        .pagination {
            margin-top: 10px;
            display: flex;
            justify-content: center;
        }
        .pagination button {
            margin: 0 5px;
        }


    </style>
</head>
<body>
<h1>Timer: <span id="timer">0</span></h1>

<canvas id="protocolChart" style="width:200px;height:300px;"></canvas>
<!--    <table id="packets-table">-->
<!--        <thead>-->
<!--            <tr>-->
<!--                <th>Time</th>-->
<!--                <th>Source</th>-->
<!--                <th>Destination</th>-->
<!--                <th>Protocol</th>-->
<!--                <th>Length</th>-->
<!--            </tr>-->
<!--        </thead>-->
<!--        <tbody>-->

<!--        </tbody>-->
<!--    </table>-->
<script>
        var socket = io();
      $(document).ready(function() {
        // Function to update the timer on the page
        function updateTimer(timer) {
            $('#timer').text(timer);
        }

      // Event listener to start receiving timer updates from the server
        socket.on('connect', function() {
            socket.emit('get_packets');
        });

        // Event listener for receiving timer updates from the server
        socket.on('packets_info', function(packet) {
            timer=packet.timer
            updateTimer(timer);
            //console.log(obj)

        });

        // Initialize the DataTable
       // var table = $('#packets-table').DataTable();

         socket.on('Completed', function(data) {
            alert('Completed Successfully')
             localStorage.setItem('data',JSON.stringify(data) )
            console.log('Packets reached =>',data)
            socket.emit('close');
           plotData();
        });
        socket.on('closed',(data)=>{
        alert("message from server ->",data.message);
        })

        const plotData=()=>{
                // Extract the protocols from the packets
        let datapackets=JSON.parse(localStorage.getItem('data'));
        var protocols = datapackets.packets.map(function(packet) {
          return packet.protocol;
        });
        // Count the occurrences of each protocol
        var protocolCounts = {};
        protocols.forEach(function(protocol) {
          protocolCounts[protocol] = (protocolCounts[protocol] || 0) + 1;
        });

                // Generate an array of background colors using a color palette
        var colorPalette = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF', '#67B8E3', '#8C9EFF', '#FF75A0', '#FFEB3B', '#3F51B5', '#FF5722', '#607D8B', '#E91E63', '#9C27B0', '#2196F3', '#009688', '#FF9800', '#795548'];
        var backgroundColors = Object.keys(protocolCounts).map(function(protocol, index) {
          return colorPalette[index % colorPalette.length];
        });

                // Prepare the data for the pie chart
        var chartData = {
          labels: Object.keys(protocolCounts),
          datasets: [{
            data: Object.values(protocolCounts),
            backgroundColor: backgroundColors
          }]
        };
        // Create the pie chart
        var ctx = document.getElementById('protocolChart').getContext('2d');
        new Chart(ctx, {
          type: 'pie',
          data: chartData,
          options: {
            // Customize the chart options if needed
          }
        });

        }
      })


</script>
</body>
</html>
